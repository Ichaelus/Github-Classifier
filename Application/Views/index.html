<!DOCTYPE html>
<html>
  <head>
    <!--
    Copyright 2016
    Code by Michael Leimstädtner
    -->
    <meta charset="utf-8"/>
    <title>Classification Overview</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="icon" href="favicon.png" type="image/png"/>
    <meta Name="description" content=""/>
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/overview.css"/>
  </head>
  <body>
    <div id="wrappers">
      <div style="display:none;"  onclick="hideInfo()" class="overlay_blur"></div>
      <div style="display:none" class="overlay_wrapper" id="predictionList_wrapper"> <!-- Overlay -->
        <div class="container">
          <h2>List prediction</h2>
          <hr>
          <div class="row">
            <div class="col-xs-6">
              <textarea placeholder="Insert one repository link per line" id="inputList"></textarea>
            </div>
            <div class="col-xs-6">
              <textarea placeholder="Classification results will be shown here" readonly id="outputList"></textarea>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-xs-4 col-xs-offset-4 text-center">
              <button v-on:click="predictList()"
              class="btn btn-primary">Start prediction</button>
            </div>
          </div>
          <div class="row">
            <div  :class="expression"
                  id="expression">
                  <span>{{expression}}</span>
            </div>
          </div>
          <div class="row text-center" style="font-style:italic">
            <span><strong>{{exprState}}</strong></span><br>
            <span>Images taken from the <a href="http://www.kasrl.org/jaffe.html" target="_blank">jaffe</a> dataset.</span>
          </div>
        </div>
      </div> <!-- /Overlay -->
      <div style="display:none" class="overlay_wrapper" id="stats_wrapper"> <!-- Overlay -->
        <div class="container">
          <h2>Sample statistics</h2>
          <hr>
          <h4><strong>Table `unlabeled`</strong></h4>
          <table class="table table-bordered table-striped measure_table"> 
            <colgroup> <col class="col-xs-4"> <col class="col-xs-2"><col class="col-xs-2"><col class="col-xs-2"><col class="col-xs-2"> </colgroup>
            <thead> <tr> <th>Numerical Attribute</th> <th>Avg</th> <th>Min</th> <th>Max</th> <th>Sum</th> </tr> </thead>
            <tbody> 
              <tr v-for="(val, m) in formatStats(numStats)"> <td scope="row"> <code>{{m}}</code> </td> <td><b>{{parseInt(parseFloat(val['AVG'])*100)/100}}</b></td> <td>{{val['MIN']}}</td> <td>{{val['MAX']}}</td> <td>{{val['SUM']}}</td> </tr>
            </tbody>
          </table>
          <table class="table table-bordered table-striped measure_table"> 
            <!-- Strings -->
            <colgroup> <col class="col-xs-6"> <col class="col-xs-6"></colgroup>
            <thead> <tr> <th>String Attribute</th> <th>Avg length</th> </tr> </thead>
            <tbody> 
              <tr v-for="(val, m) in formatStats(strStats)"> <td scope="row"> <code>{{m}}</code> </td> <td><b>{{parseInt(parseFloat(val['AVG'])*100)/100}}</b></td></tr>
            </tbody>
          </table>
        </div>
      </div> <!-- /Overlay -->
      <div style="display:none;" class="overlay_wrapper" id="details_wrapper"> <!-- Overlay -->
        <div class="container">
          <h2>Classifier Module</h2>
          <hr>
          <div class="attributes">
            <div class="row attribute">
              <div class="col-xs-3">Name</div>
              <div class="col-xs-9">{{currentName}}</div>
            </div>
            <div class="row attribute">
              <div class="col-xs-3">Description</div>
              <div class="col-xs-9">{{current.description}}</div>
            </div>
            <div class="row attribute">
              <div class="col-xs-3">Yield</div>
              <div class="col-xs-9">{{parseInt(current.yield * 100)}}%</div>
            </div>
            <div class="row attribute">
              <div class="col-xs-3">Currently enabled</div>
              <div class="col-xs-9">{{current.active ? 'Yes' : 'No'}}</div>
            </div>
          </div>
          <h3>Actions</h3>
          <hr>
          <span class="action btn btn-default" v-on:click="retrain(currentName, false)">Retrain from scratch</span>
          <span class="action btn btn-default" v-on:click="retrain_semi()">Retrain with semi-supervised data</span>
          <span class="action btn btn-default" v-on:click="save(currentName)">Save current image</span>
          <div class="version_wrapper">
            <div class="input-group-btn select">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><b>{{selectedPoint == '' ? 'Version' : selectedPoint}}</b> <span class="caret"></span></button>
                  <ul class="dropdown-menu" style="margin: 0px auto;">
                    <li v-for="(sp, fileName) in savePoints"><a v-on:click="setSavePoint(fileName)" href="#">{{fileName}} <b>({{parseInt(sp.yield * 100)+'%'}}</b>)</a></li>
                  </ul>
            </div>
            <span class="action btn btn-default" v-on:click="load()">Load version</span>
          </div>
          <h3>Performance Graphs</h3>
          <!--
          <div class="graph">
          <hr>
            <h4><strong>Per class accuracy</strong></h4>
            <div id="class_accuarcy_chart"></div>
          </div>-->
          <div class="graph">
            <h4><strong>Overall accuracy per version</strong></h4>
            <div id="version_accuarcy_chart"></div>
            <!--<img src="http://www.visualcinnamon.com/wp-content/uploads/2015/09/D3-radar-chart-New-version-Hover.png">-->
          </div>
          <div class="graph">
            <h4><strong>Confusion matrix</strong></h4>
            <table id="confusion_matrix" class="table">
              <tbody>
                <tr>
                  <th>▼ Class. \ Reference ► </th>
                  <th v-for="(c, i) in current.confusionMatrix.order">{{c}}</th>
                  <th>Total</th>
                  <th>C.A. (%)</th>
                </tr>
                <tr v-for="(r, i) in current.confusionMatrix.matrix"
                    :class="(i >= current.confusionMatrix.order.length ? 'total' : '') ">
                  <td>
                      {{(i <  current.confusionMatrix.order.length ? current.confusionMatrix.order[i] : (current.confusionMatrix.order.length == i ? 'Total' : 'P.A. (%)'))}}</td>

                  <td v-for="(r2, i2) in current.confusionMatrix.matrix[i]" 
                      :class="(i == i2 ? 'cell_own' : (i < i2 ? 'cell_classifier': 'cell_reference'))">
                      {{parseInt(current.confusionMatrix.matrix[i][i2] * 100) / 100}}</td>

                </tr>
              </tbody>
            </table>
            <h4><strong>Measure table</strong></h4>
            <table class="table table-bordered table-striped measure_table"> 
              <colgroup> <col class="col-xs-6"> <col class="col-xs-6"> </colgroup>
              <thead> <tr> <th>Measure</th> <th>Result</th> </tr> </thead>
              <tbody> 
                <tr v-for="(val, m) in current.confusionMatrix.measures"> <td scope="row"> <code>{{m}}</code> </td> <td>{{val}}</td> </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div> <!-- /Overlay -->
    </div> <!-- /Wrappers -->
    <div id="page" class="container-fluid" style="display:none;">
      <div id="header">
        <div class="container">
          <div class="col-xs-4">
            <h1>Classification Overview</h1>

              <div :class="'control_buttons ' + ((mode == 'stream' || mode == 'pool') ? '' : 'hidden')"><!--control-subgroup-->
                  <span :class="(action == 'loop' ? 'active ' : '') + 'glyphicon glyphicon-play'" v-on:click="loop()" data-toggle="tooltip" data-placement="top" title="Train until paused"></span>
                  <span :class="(action == 'halt' ? 'active ' : '') + 'glyphicon glyphicon-pause'" v-on:click="halt()" data-toggle="tooltip" data-placement="top" title="Stop training"></span>
                  <span class="glyphicon glyphicon-step-forward" v-on:click="singleStep()" data-toggle="tooltip" data-placement="top" title="Train a single sample">
                  </span>
              </div><!-- /control-subgroup -->

          </div>
          <div class="col-xs-8">
            <div class="col-xs-6">
              <div class="input-group">
                <span class="input-group-addon">
                  <input id="mode_1" v-on:change="switchMode()" value="stream" v-model="mode" name="mode" type="radio">
                </span>
                <label for="mode_1" class="form-control">Stream Based AL</label>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon">
                  <input id="mode_2" v-on:change="switchMode()" value="pool" v-model="mode" name="mode" type="radio">
                </span>
                <label for="mode_2" class="form-control">Pool Based AL</label>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon">
                  <input id="mode_3" v-on:change="switchMode()" value="test" v-model="mode" name="mode" type="radio">
                </span>
                <label for="mode_3" class="form-control">Test all Classifiers</label>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon">
                  <input id="mode_4" v-on:change="switchMode()" value="single" v-model="mode" name="mode" type="radio">
                </span>
                <label for="mode_4" class="form-control">Predict single samples</label>
              </div>   <!-- /input-group -->  
            </div>
            <div id="right" :class="'col-xs-6 '"><!-- right side options -->

              <div :class="'input-group ' + ((mode != 'stream' && mode != 'pool') ? 'hidden' : '')">
                <span class="input-group-addon">
                  <input id="instant_train" v-model="trainInstantly" name="instant_train" type="checkbox">
                </span>
                <label for="instant_train" class="form-control">Classify instantly and train incrementaly</label>
              </div>   <!-- /input-group -->  

              <div  :class="'input-group ' + (mode == 'stream' ? '' : 'hidden') ">
                <span class="input-group-addon">
                  <input disabled="disabled" id="semi_supervised" v-model="isSemiSupervised" name="semi_supervised" type="checkbox">
                </span>
                <label for="semi_supervised" class="form-control">Semi-Supervised</label>
              </div>   <!-- /input-group -->  

              <div :class="'input-group ' + ((mode != 'stream' && mode != 'pool') ? 'hidden' : '')">
                <label id="formula" class="form-control">{{formula}}</label>
                <div class="input-group-btn">
                  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Uncertainty formula <span class="caret"></span></button>
                  <ul class="dropdown-menu dropdown-menu-right">
                    <li v-for="f in formulas"><a v-on:click="setFormula(f)" href="#">{{f}}</a></li>
                  </ul>
                </div><!-- /btn-group -->
              </div><!-- /input-group -->
              <input v-on:click="predictSingle('')"
                    :class="'btn btn-primary control ' + ((mode == 'single') ? '' : 'hidden')" 
                    title="Predict single samples" value="Predict single" type="button">
              <input v-on:click="showListPrediction()"
                    :class="'btn btn-primary control ' + ((mode == 'single') ? '' : 'hidden')" 
                    title="Predict a list of samples" value="Predict list" type="button">
              <input v-on:click="startTest()" 
                    :class="'btn btn-primary control ' + ((mode == 'test') ? '' : 'hidden')" 
                    title="Test all Classifiers" value="Start testing" type="button">
              <input v-on:click="retrainAll()" value="Retrain and save all" 
                    :class="'btn btn-primary ' + ((mode == 'test') ? '' : 'hidden')" type="button">
              <input v-on:click="showStats()" value="Display sample statistics" 
                    :class="'btn btn-primary ' + ((mode == 'test') ? '' : 'hidden')" type="button">
            </div><!-- /right side options -->
          </div><!-- /controls -->
        </div><!-- /container -->
      </div><!-- /header -->
      <div class="container">

        <div id="titles" class="row"><!-- titles -->
          <blockquote class="lead" v-html="getQuote()"></blockquote>
          <div class="col-xs-2"><h3>Input</h3></div>
          <div class="col-xs-7">
            <div class="col-xs-4"><h3>Classifiers</h3></div>
            <div class="col-xs-7 col-xs-offset-1"><h3>{{(mode != 'test' ? 'Classification results' : 'Accuracy per class')}}</h3></div>
          </div>
          <div class="col-xs-3"><h3>Output</h3></div>
        </div><!-- /titles -->

        <div class="row main"><!-- main -->
          <div id="input" class="col-xs-2"><!-- input -->
            <h4 
                class="subtitle"
                v-show="state != 'showResult' && state != 'empty'"
            >{{state}}</h4>
            <div 
                :class="'repoDetails ' + (getMode() == 'test' || state != 'showResult' ? 'hidden' : '')">
              <h4><small>{{repo.author}} / </small>{{repo.repoName}}</h4>
              <p>{{shortDesc}}</p>
              <table class="table table-bordered table-striped measure_table"> 
                <!-- Strings -->
                <colgroup> <col class="col-xs-6"> <col class="col-xs-6"></colgroup>
                <thead> <tr> <th>Feature</th> <th>Value</th> </tr> </thead>
                <tbody> 
                  <tr> <td scope="row">#Folders</td> <td><code>{{repo.folder_count}}</code></td></tr>
                  <tr> <td scope="row">#Files</td> <td><code>{{repo.file_count}}</code></td></tr>
                  <tr> <td scope="row">#Commits</td> <td><code>{{repo.commit_count}}</code></td></tr>
                  <tr> <td scope="row">Language</td> <td><code>{{repo.language}}</code></td></tr>
                </tbody>
              </table>
            </div>
            <div 
              :class="'trainCount '  + (getMode() != 'test' ? 'hidden' : '')">
              <h4 class="subtitle">Train sample distribution</h4>
              <table class="table table-bordered table-striped measure_table"> 
                <!-- Strings -->
                <colgroup> <col class="col-xs-6"> <col class="col-xs-6"></colgroup>
                <thead> <tr> <th>Class</th> <th>#Train samples</th> </tr> </thead>
                <tbody> 
                  <tr v-for="x in trainCount"> <td scope="row">{{x.class}}</td> <td><code>{{x.count}}</code></td></tr>
                </tbody>
              </table>
            </div>
          </div><!-- /input -->

          <div class="col-xs-7">
            <div id="classifier_wrapper">
              <h4 class="subtitle"> Order classifiers by 
                   <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      {{selectedMeasure}} <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                      <li v-for="measure in measures" v-on:click="changeMeasure(measure)"><a href="#">{{measure}}</a></li>
                    </ul>
                </div>
              </h4>
              <div id="classifiers">
                <div v-for="c in orderedClassifiers" :class="'classifier_row' + (c.active ? '' : ' inactive') ">
                  <div :class="'classifier ' + (isAsking(c.name) ? 'asking' : '')">
                    <span class="name">{{c.name}}</span>
                    <div class="wrapper">
                      <span data-toggle="tooltip" data-placement="top" :data-original-title="'Current ' + selectedMeasure" class="stats">{{parseInt(c.confusionMatrix.measures[selectedMeasure] * 100)}}%<!-- <span title="Accuracy of previous version" class="old">/ 79%</span>--></span>
                      <span data-toggle="tooltip" data-placement="top" title="Show classifier details" v-on:click="showInfo(c.name)" class="glyphicon glyphicon-info-sign"></span>
                      <span data-toggle="tooltip" data-placement="top" title="Enable classifier" v-on:click="switchState(c.name)" class="glyphicon glyphicon-ban-circle"></span>
                      <span data-toggle="tooltip" data-placement="top" title="Disable classifier" v-on:click="switchState(c.name)" class="glyphicon glyphicon-ok-circle"></span>
                    </div>
                  </div>
                  <div class="arrow">=&gt;</div>
                  <div :class="'result_vector ' + (getMode() != 'test' ? 'hidden' : '')">
                      <div v-for="(r, i) in c.accuracy" :class="'v ' + (getMax(c.name)  == r.val ? 'max' : '')">
                        <span>{{r.class}}</span><span>{{Math.round(r.val * 100) / 100}}</span>
                      </div>
                  </div>
                  <div :class="'result_vector ' + (getMode() == 'test' ? 'hidden' : '')">
                      <div v-for="(r, i) in c.probability" :class="'v ' + (getMax(c.name)  == r.val ? 'max' : '')">
                        <span>{{r.class}}</span><span>{{Math.round(r.val * 100) / 100}}</span>
                      </div>
                  </div>
                  <div data-toggle="tooltip" data-placement="top" title="Classifier uncertainty" :class="'uncertainty ' + (c.uncertainty > 0 ? '' : 'hidden ') + (typeof(c.unsure) != 'undefined' ? (c.unsure ? 'uncertain ' : 'certain ') : ' ')">
                    {{parseInt(c.uncertainty * 100) / 100}}
                  </div>
                </div>
              </div><!-- /classifiers -->
            </div>
          </div>

          <div class="col-xs-3" id="output"><!-- output -->
             <div v-show="getMode() == 'test'">
               <h4 class="subtitle">Classifiers best accuracy by class</h4>
               
               <table class="outputDistr table table-bordered table-striped measure_table">
                <colgroup><col class="col-xs-2"> <col class="col-xs-10"></colgroup>
                <thead><tr><th>Class</th> <th>#Best scores</th></tr></thead>
                <tbody>
                  <tr v-for="(x, i) in accuracyDistribution"><td scope="row">{{x.name}}</td> <td><div class="bar" :style="{width: x.percentage + '%'}">{{x.count}}</div></td></tr>
                </tbody>
              </table>
            </div>
             <div v-show="getMode() != 'test' && state == 'showResult'">
               <h4 class="subtitle">Most predicted classes</h4>
               <table class="outputDistr table table-bordered table-striped measure_table">
                <colgroup><col class="col-xs-2"> <col class="col-xs-10"></colgroup>
                <thead><tr><th>Class</th> <th>#Predictions</th></tr></thead>
                <tbody>
                  <tr v-for="(x, i) in predictionDistribution"><td scope="row">{{x.name}}</td> <td><div class="bar" :style="{width: x.percentage + '%'}">{{x.count}}</div></td></tr>
                </tbody>
              </table>
            </div>
            <h2 v-on:click="manualClassification()"
                :class="(getMode() != 'test' && classifiersUnsure ? '' : 'hidden ') + (manualClass == '?' ? 'uncertain' : '')" 
                :style="{top: 'calc( 35px * (-1 + '+getClassifierAmount()+') * 75px)'}"
                :title="(manualClass == '?' ? 'Click to manually classify this sample' : 'Classification result')">{{( manualClass)}}</h2>
            <!--<div :class="(getMode() == 'test' ? '' : 'hidden ')" 
                 :style="{top: 'calc( 0px + (-1 + '+getClassifierAmount()+') * 75px)'}"
                 id="testOuputChart"></div>-->

            <div :class="(getMode() == 'test' ? '' : 'hidden ')" 
                 :style="{top: 'calc( -60px + (-1 + '+getClassifierAmount()+') * 75px)'}"
                 id="testOuputChart"></div>
          </div><!-- /output -->

        </div><!-- /main -->
      </div><!-- /container -->
    </div><!-- /container-fluid -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.17.2/lodash.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vue@2.0.3/dist/vue.js"></script>
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="scripts/radarChart.js"></script>
    <script type="text/javascript" src="scripts/frontend.js"></script>
  </body>
</html>